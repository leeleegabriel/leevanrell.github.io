<!DOCTYPE html>
<html lang="en">
  <head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<link href="https://fonts.googleapis.com/css?family=Merriweather:300|Raleway:400,700" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/style.css">
<link rel="shortcut icon" href="/assets/favicon.ico"/>
<title>Just another Pihole guide</title>
<!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Just another Pihole guide - Lee Vanrell</title>
<meta property="og:title" content="Just another Pihole guide" />
<meta name="description" content="Here’s a quick how-to for setting up a Pihole server at home." />
<meta property="og:description" content="Here’s a quick how-to for setting up a Pihole server at home." />
<link rel="canonical" href="https://leevanrell.github.io/raspberrypi/pihole/2020/02/10/Just-another-pihole-guide/" />
<meta property="og:url" content="https://leevanrell.github.io/raspberrypi/pihole/2020/02/10/Just-another-pihole-guide/" />
<meta property="og:site_name" content="Lee Vanrell" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-02-10T19:31:11-06:00" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Just another Pihole guide",
"datePublished": "2020-02-10T19:31:11-06:00",
"description": "Here’s a quick how-to for setting up a Pihole server at home.",
"url": "https://leevanrell.github.io/raspberrypi/pihole/2020/02/10/Just-another-pihole-guide/"}</script>
<!-- End Jekyll SEO tag -->
</head>
  <body>
    <main class="container">
      <section class="about">
        <a href="/"><img src="/assets/portfolio.png" alt="Lee Vanrell"></a>
        <h2 id="title">
          <a href="/">Lee Vanrell</a>
        </h2>
        <p class="tagline">Software Engineer</p>
        <ul class="social"><a href="https://github.com/leevanrell">
              <li>
                <i class="icon-github-circled"></i>
              </li>
            </a><a href="https://www.linkedin.com/in/leevanrell">
              <li>
                <i class="icon-linkedin-squared"></i>
              </li>
            </a><a href="https://twitter.com/lee_vanrell">
              <li>
                <i class="icon-twitter-squared"></i>
              </li>
            </a></ul><nav class="navigation">
            <ul>
              
                <li>
                  <a href="/about">About Me</a>
                </li>
              
                <li>
                  <a href="/bookmarks">Bookmarks</a>
                </li>
              
                <li>
                  <a href="/feed.xml">Subscribe</a>
                </li>
              
            </ul>
          </nav><p>&copy;
          2020</p>
      </section>
      <section class="content">
        <div class="post-container">
  <a class="post-link" href="/raspberrypi/pihole/2020/02/10/Just-another-pihole-guide/">
    <h2 class="post-title">Just another Pihole guide</h2>
  </a>
  <div class="post-meta">
    <ul class="post-categories"><li>RaspberryPi</li><li>PiHole</li></ul>
    <div class="post-date"><i class="icon-calendar"></i>Feb 10, 2020</div>
  </div>
  <div class="post">
    <p>Here’s a quick how-to for setting up a Pihole server at home.</p>

<p>First, you need to setup a VM/raspberrypi to host the Pihole. I decided to just run Pihole off a VM on my ESXi server I already had.</p>

<p>The VM I’m using is a Ubuntu 18.04 LTS Server image. To get it to work with Pihole we’ll have to make the IP static so it doesn’t up and change on us.</p>

<p>Since Ubuntu 17(?), Ubuntu uses netplan for configuring it’s ethernet interfaces. So let’s go to its config file at /etc/netplan/50-cloud.yaml (alternatively create a file called 01-netcfg.yaml and remove the default files). Edit the text so it looks like this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>network:
  version: 2
  renderer: networkd
  ethernets: 
    ens160:
      dhcp4: no
      addresses:
        - 192.168.1.100/24
      gateway4: 192.168.1.1
      nameservers:
        addresses: [192.168.1.1]
</code></pre></div></div>
<p>Be wary that your ethernet interface name/ip subnet may vary, mine is ens160. Also, set your address to whatever you like, but I’ll be using 192.168.1.100. Once you’re done, run</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ sudo netplan apply
</code></pre></div></div>

<p>Now to install Pihole. Simply run:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ curl -sSL https://install.pi-hole.net | bash
</code></pre></div></div>

<p>It will prompt you for a few options like what external DNS you’d like to use, OpenDNS, Quad9, and DNSWatch are all fine. Once it’s finished it will show a screen with a randomly generated password to access the Pihole admin menu.</p>

<p>Next, login at http://192.168.1.100/admin/ using the password provided. Now you have your very own DNS server.</p>

<p>There’s a few quality of life improvements I recommend:</p>

<p>First, lets add some more blocklists. Click Tools &gt; blocklists. Then copy and paste this into the text block:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts
https://mirror1.malwaredomains.com/files/justdomains
http://sysctl.org/cameleon/hosts
https://s3.amazonaws.com/lists.disconnect.me/simple_tracking.txt
https://s3.amazonaws.com/lists.disconnect.me/simple_ad.txt
https://hosts-file.net/ad_servers.txt
https://raw.githubusercontent.com/nicholasb2101/PiHole/master/Blocklists/Primary%20Blocklist.txt
https://raw.githubusercontent.com/nicholasb2101/PiHole/master/Blocklists/Secondary%20Blocklist.txt
</code></pre></div></div>
<p>Click save and update, it may take a minute.</p>

<p>To make your devices use Pihole you can set all your devices to use 192.168.1.100 for DNS requests.
I also recommend setting your router’s default DNS to your Pihole’s IP (192.168.1.100) and just set your devices default DNS to 192.168.1.1. This way if you ever want to make a change you can do it from your router’s admin menu once, instead of multiple times on multiple devices.</p>

<p>To force devices that are hardcoded to use external DNS you can configure your router to redirect all DNS requests to your Pihole. To do so, ssh into your router (if your router doesn’t support ssh look up the <a href="https://openwrt.org/">OpenWRT project</a>, it supports many routers on the market) and enter these commands. Your ssh session may lockup on the first command, just give it time.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables -t nat -A PREROUTING -s 192.168.1.1 -j ACCEPT 
iptables -t nat -A PREROUTING -d 192.168.1.100 -j ACCEPT
iptables -t nat -A OUTPUT -p udp --dport 53 -j DNAT --to 192.168.1.100
iptables -t nat -A OUTPUT -p tcp --dport 53 -j DNAT --to 192.168.1.100
</code></pre></div></div>

<p>That’s all the configurations I’ve made to my Pihole so far, and I’m immensely satisfied.</p>

<p>Fin.</p>

  </div></div>

      </section>
    </main><script async src="https://www.googletagmanager.com/gtag/js?id=UA-156487363-1"></script>
      <script>
		window.dataLayer = window.dataLayer || [];
		function gtag() { dataLayer.push(arguments); }
		gtag('js', new Date());

		gtag('config', 'UA-156487363-1');
	</script></body>
</html>
